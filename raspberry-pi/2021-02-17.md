# 2021-02-17

- [2021-02-17](#2021-02-17)
  - [Device ê³µê°„ í™•ë³´í•˜ê¸°](#device-ê³µê°„-í™•ë³´í•˜ê¸°)
  - [ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì›ê²©ì§€ Kubernetes í´ëŸ¬ìŠ¤í„° ì ‘ì†í•˜ê¸°](#ë¡œì»¬-ì»´í“¨í„°ì—ì„œ-ì›ê²©ì§€-kubernetes-í´ëŸ¬ìŠ¤í„°-ì ‘ì†í•˜ê¸°)
  - [References](#references)
    - [Device ê³µê°„ í™•ë³´í•˜ê¸°](#device-ê³µê°„-í™•ë³´í•˜ê¸°-1)
    - [ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì›ê²©ì§€ Kubernetes í´ëŸ¬ìŠ¤í„° ì ‘ì†í•˜ê¸°](#ë¡œì»¬-ì»´í“¨í„°ì—ì„œ-ì›ê²©ì§€-kubernetes-í´ëŸ¬ìŠ¤í„°-ì ‘ì†í•˜ê¸°-1)

---

## Device ê³µê°„ í™•ë³´í•˜ê¸°

ë©°ì¹  ëª» ë“¤ì–´ì˜¤ë‹¤ê°€ ì˜¤ëœë§Œì— ë“¤ì–´ì™”ë”ë‹ˆ ì„œë¹„ìŠ¤ê°€ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ë‹¤.

ì™œì¸ì§€ ë¡œê·¸ë¥¼ ë³´ë‹ˆ ê³µê°„ì´ ë¶€ì¡±í•˜ë‹¤ê³  ëœ¬ë‹¤...?

`28: No space left on device`ëŒ€ì¶© ì´ëŸ° ë‚´ìš©...

ì™œ... ì´ëŸ° ì—ëŸ¬ê°€ ëœ°ê¹Œ... ë‚œ k3s ì„¤ì¹˜ë§Œí•˜ê³  ë‹¤ë¥¸ê±´ ì„¤ì¹˜ ì•ˆí–ˆëŠ”ë°... í•˜ê³  ìš©ëŸ‰ì„ í™•ì¸í•´ë´¤ë‹¤.

```
pi@raspberrypi:~ $ df -h
```

`/dev/root`ì˜ ìš©ëŸ‰ì´ ê±°ì˜ ê½‰ ì°¨ìˆì—ˆë‹¤... (ì§€ê¸ˆì€ ì‚­ì œí•´ì„œ ì•ˆë³´ì´ëŠ”ë° ì§„ì§œ 100%...)

ì™œ??? í•˜ê³  [https://www.digitalocean.com/community/questions/28-no-space-left-on-device-error](https://www.digitalocean.com/community/questions/28-no-space-left-on-device-error)ë¥¼ í™•ì¸í•´ë³´ë‹ˆ,

ìš©ëŸ‰ 500M ì´ìƒì¸ íŒŒì¼ì„ í™•ì¸í•˜ëŠ” ì»¤ë§¨ë“œê°€ ìˆì–´ì„œ ì‹¤í–‰í•´ë³´ì•˜ë‹¤.

```
$ sudo find / -type f -size +500M -exec ls -lh {} \;
```

ê·¸ë¬ë”ë‹ˆ ëª‡ ê¸°ê°€ë‚˜ ë˜ëŠ” íŒŒì¼ë“¤ì´... ìˆì—ˆê³ , ëª¨ë‘ `/var/log`ì•ˆì˜ íŒŒì¼ë“¤ì´ì—ˆë‹¤.

ì•„...!

ì§€ìš°ê³  ë‚˜ë‹ˆ ì—ëŸ¬ê°€ ì‚¬ë¼ì¡Œë‹¤... í–‰...ë³µ...

---

## ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì›ê²©ì§€ Kubernetes í´ëŸ¬ìŠ¤í„° ì ‘ì†í•˜ê¸°

ë¼ì¦ˆë² ë¦¬íŒŒì´ì— ì ‘ì†í•´ì„œ ë§¤ë²ˆ k8s í´ëŸ¬ìŠ¤í„°ì— ì ‘ì†í•  í•„ìš”ê°€ ìˆì„ê¹Œ

ë¼ëŠ” ìƒê°ë„ ì‚¬ì‹¤ í•˜ì§€ ëª»í–ˆë‹¤.

ë‹¹ì—°íˆ ë¼ì¦ˆë² ë¦¬íŒŒì´ì— ë“¤ì–´ê°€ì„œ ì„¤ì •í•˜ëŠ”ê±´ì¤„ ì•Œì•˜ëŠ”ë°

ì•Œê³ ë³´ë‹ˆ ë‚˜ë„ ì´ë¯¸ ì›ê²©ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ì ‘ì†ì„ í•˜ê³  ìˆì—ˆë˜ ê²ƒì´ì—ˆë‹¤...

ê·¸ëŸ¼ ì–´ë–»ê²Œ ì„¤ì •í•˜ë©´ ì¢‹ì„ê¹Œ?

ì •í™•íˆëŠ” ê¸°ì¡´ì— ì˜ ì“°ê³  ìˆë˜ ì„¤ì •ì—ëŠ” ì „í˜€ ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë©´ì„œ ì–´ë–»ê²Œ ì„¤ì •í•˜ë©´ ì¢‹ì„ê¹Œ? ì´ë‹¤.

ê´œíˆ ê¸°ì¡´ì— ì˜ ì“°ê³  ìˆëŠ” ì„¤ì •ì„ ë°”ê¿¨ë‹¤ê°€ ëŒì´í‚¬ ìˆ˜ ì—†ëŠ” ì‹¤ìˆ˜ë¥¼ í•œë‹¤ë©´...

ë§¤ìš° í”¼ê³¤í•´ì§„ë‹¤...

ê·¸ëŸ¬ë©´ ì¼ë‹¨ ë°±ì—…ì„ í•´ì•¼í•œë‹¤!

í•´ë‹µì€ ì—­ì‹œ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ì— ìˆì—ˆë‹¤. ([https://askubuntu.com/a/962511](https://askubuntu.com/a/962511))

```
$ cp example_file{,.bak}
```

ì„ í†µí•´ì„œ ê¸°ì¡´ íŒŒì¼ì„ ì†ì‰½ê²Œ .bak ìœ¼ë¡œ ë°±ì—…í•´ë‘˜ ìˆ˜ ìˆë‹¤.

ë‚˜ëŠ” ì§€ê¸ˆ `.kube/config`íŒŒì¼ì„ ìˆ˜ì •í•  ê²ƒì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ íŒŒì¼ì„ ìš°ì„  ë°±ì—…í•´ë‘ì—ˆë‹¤.

ê·¸ ë‹¤ìŒì—ëŠ”, ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ k3s ì„¤ì •í•´ì¤€ config íŒŒì¼ì„ ì˜®ê¸°ë©´ ëœë‹¤.

k3së¥¼ ì„¤ì¹˜í•˜ë©´, í´ëŸ¬ìŠ¤í„°ì˜ ì¸ì¦ì„œì™€ ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ ë“± ì¸ì¦í•˜ëŠ”ë° í•„ìš”í•œ ì •ë³´ê°€

`/etc/rancher/k3s/k3s.yaml`ì— ì €ì¥ë˜ë‹ˆ ìš°ì„  í•´ë‹¹ íŒŒì¼ ë‚´ìš©ì„ ë³´ì.

ëŒ€ì¶© êµ¬ì„±ì€

```
apiVersion:
clusters:
  - cluster:
      ì¸ì¦ì„œë‚´ìš©:
      server:
      name:
  - cluster:
      ì¸ì¦ì„œë‚´ìš©:
      server:
      name:
  - cluster:
      ì¸ì¦ì„œë‚´ìš©:
      server:
      name:
contexts:
  - context:
      cluster:
      user:
      name:
  - context:
      cluster:
      user:
      name:
  - context:
      cluster:
      user:
      name:
current-context:
kind:
preferences:
users:
  - name:
    user:
      ì¸ì¦ì„œë‚´ìš©:
      ì¸ì¦í‚¤ë‚´ìš©:
  - name:
    user:
      ì¸ì¦ì„œë‚´ìš©:
      ì¸ì¦í‚¤ë‚´ìš©:
  - name:
    user:
      ì¸ì¦ì„œë‚´ìš©:
      ì¸ì¦í‚¤ë‚´ìš©:
```

ê¼´ì´ë©°, `clusters`, `contexts`, `users`ëŠ” ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì¡´ì¬ê°€ëŠ¥í•˜ë‹¤.

ê·¸ëŸ¼ `.kube/config` ë°±ì—…ë„ í–ˆê² ë‹¤... `/etc/rancher/k3s/k3s.yaml`ì— ì €ì¥ëœ ë‚´ìš©ì„ ì˜®ê¸´ ë‹¤ìŒì—

```
$ kubectl config use-context your-context-name
```

ìœ¼ë¡œ ë³€ê²½í•´ê°€ë©´ì„œ ê¸°ì¡´ì— ì¸ì¦ë‚´ìš©ì´ ì˜ë˜ëŠ”ì§€ í™•ì¸ ë¨¼ì € í•˜ê³ !!!

ê·¸ ë‹¤ìŒì— ìƒˆë¡œ ì¶”ê°€í•œ ë¼ì¦ˆë² ë¦¬íŒŒì´ì˜ k3s context ì—ë„ ë¶™ì–´ì„œ

```
$ kubectl get nodes
NAME          STATUS   ROLES                  AGE    VERSION
raspberrypi   Ready    control-plane,master   4d1h   v1.20.2+k3s1
```

ì²˜ëŸ¼ ì˜ ê°€ì ¸ì˜¤ëŠ”ì§€ í™•ì¸í•˜ë©´ ëœë‹¤.

ì•„, ê¸°ì¡´ì— í¬íŠ¸ ì„¤ì •ë•Œë¬¸ì— í¬íŠ¸í¬ì›Œë”©ì„ ì¶”ê°€í–ˆì—ˆë‹¤.

ê³¼ì—° ì´ê±¸ ë¹¼ë©´ ì•ˆë˜ëŠ”ì§€ ì§€ê¸ˆ í™•ì¸í•´ë³´ê² ë‹¤.

```
// í˜„ì¬ context í™•ì¸
zhoon ğŸ”¥  î‚°
î‚° kube-current-context
raspberry-pi-k3s

// ì›ê²©ì— ë¶™ì–´ì„œ ì˜ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸ (í¬íŠ¸í¬ì›Œë”© ëœ ìƒíƒœ; ì™¸ë¶€ : 6443, ë‚´ë¶€ : ë‚´ë¶€í¬íŠ¸)
 zhoon ğŸ”¥  î‚°
î‚° kubectl get nodes -o wide
NAME          STATUS   ROLES                  AGE    VERSION        INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
raspberrypi   Ready    control-plane,master   4d2h   v1.20.2+k3s1   192.168.0.105   <none>        Raspbian GNU/Linux 10 (buster)   5.10.11-v7+      containerd://1.4.3-k3s1
 zhoon ğŸ”¥  î‚°
î‚° kubectl get nodes
NAME          STATUS   ROLES                  AGE    VERSION
raspberrypi   Ready    control-plane,master   4d2h   v1.20.2+k3s1

// í¬íŠ¸í¬ì›Œë”©ì„ í•´ì œí•˜ë‹ˆ ì›ê²©ì— ëª» ë¶™ëŠ” ê²ƒì„ í™•ì¸
 zhoon ğŸ”¥  î‚°
î‚° kubectl get nodes -o wide
The connection to the server 192.168.0.105:6443 was refused - did you specify the right host or port?
 âœ˜ zhoon ğŸ”¥  î‚°
î‚° kubectl get nodes -o wide
Error from server (ServiceUnavailable): the server is currently unable to handle the request (get nodes)
 âœ˜ zhoon ğŸ”¥  î‚°
î‚° kubectl get nodes
Error from server (ServiceUnavailable): the server is currently unable to handle the request (get nodes)

// ë‹¤ì‹œ í¬íŠ¸í¬ì›Œë”©í•˜ë‹ˆ, ì˜ ë¶™ì–´ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸
 âœ˜ zhoon ğŸ”¥  î‚°
î‚° kubectl get nodes -o wide
NAME          STATUS   ROLES                  AGE    VERSION        INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
raspberrypi   Ready    control-plane,master   4d2h   v1.20.2+k3s1   192.168.0.105   <none>        Raspbian GNU/Linux 10 (buster)   5.10.11-v7+      containerd://1.4.3-k3s1
 zhoon ğŸ”¥  î‚°
î‚° kubectl get nodes
NAME          STATUS   ROLES                  AGE    VERSION
raspberrypi   Ready    control-plane,master   4d2h   v1.20.2+k3s1
```

ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ íŠ¹ì • í¬íŠ¸ë¡œ ìˆ˜ì •í•œ ë’¤ì—, ì™¸ë¶€ì—ì„œ 6443ìœ¼ë¡œ ë¶™ìœ¼ë ¤ê³  í•˜ë‹ˆ, ì œëŒ€ë¡œ ëª» ë¶™ì—ˆë‹¤.

ê·¸ë˜ì„œ ê³µìœ ê¸° ì„¤ì •ì—ì„œ `ì™¸ë¶€ëŠ” 6443`, `ip ëŠ” ë‚´ë¶€ ip`, `ë‚´ë¶€ ipëŠ” íŠ¹ì • í¬íŠ¸`ë¡œ í•´ì£¼ë‹ˆ, ì˜ ë¶™ì—ˆë‹¤.

ê²°ë¡ , k3s í¬íŠ¸ ì„¤ì •í•´ì¤€ ì¹œêµ¬ë¡œ ì˜ ë¶™ì–´ì•¼ í•œë‹¤.

---

## References

### Device ê³µê°„ í™•ë³´í•˜ê¸°

- [https://www.digitalocean.com/community/questions/28-no-space-left-on-device-error](https://www.digitalocean.com/community/questions/28-no-space-left-on-device-error)

### ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì›ê²©ì§€ Kubernetes í´ëŸ¬ìŠ¤í„° ì ‘ì†í•˜ê¸°

- [k3s ì‹œë¦¬ì¦ˆ - ê°„ë‹¨í•˜ê²Œ Kubernetes í™˜ê²½ êµ¬ì¶•í•˜ê¸°](https://si.mpli.st/dev/2020-01-01-easy-k8s-with-k3s/)
